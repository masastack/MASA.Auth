@inherits AdminCompontentBase

<MRow Class="pt-4">
    <MCol Md=12>
        <DefaultTextField @bind-Value="Dto.RedirectUri" Label="@T("CallBackRedirectUri")" Suffix="@redirectUriSuffix"
                          AppendOuterIcon="@IconConstants.Add" OnAppendOuterClick="AddCallBackRedirectUri" />
    </MCol>
    @foreach (var uri in Dto.RedirectUris)
    {
        <MCol Md=6 Class="d-flex">
            <DefaultTextField Dense HideDetails="true" Value="uri" Filled Disabled Class="flex-grow-1" />
            <MIcon Class="ml-2" OnClick="()=>RemoveCallBackRedirectUri(uri)">mdi-close-circle</MIcon>
        </MCol>
    }
    <MCol Md=12>
        <DefaultTextField @bind-Value="Dto.PostLogoutRedirectUri" Label="@T("PostLogoutRedirectUri")" Suffix="@logoutRedirectUriSuffix"
                          AppendOuterIcon="@IconConstants.Add" OnAppendOuterClick="AddLogoutRedirectUri" />
    </MCol>
    @foreach (var uri in Dto.PostLogoutRedirectUris)
    {
        <MCol Md=6 Class="d-flex">
            <DefaultTextField Dense HideDetails="true" Value="uri" Filled Disabled />
            <MIcon Class="ml-2" OnClick="()=>RemoveLogoutRedirectUri(uri)">mdi-close-circle</MIcon>
        </MCol>
    }
    <MCol Md=6>
        <DefaultTextField @bind-Value="Dto.FrontChannelLogoutUri" Label="FrontChannelLogoutUri" />
    </MCol>
    <MCol Md=6>
        <MCheckbox @bind-Value="Dto.FrontChannelLogoutSessionRequired" Label="FrontChannelLogoutSessionRequired"></MCheckbox>
    </MCol>
    <MCol Md=6>
        <DefaultTextField @bind-Value="Dto.BackChannelLogoutUri" Label="BackChannelLogoutUri" />
    </MCol>
    <MCol Md=6>
        <MCheckbox @bind-Value="Dto.BackChannelLogoutSessionRequired" Label="BackChannelLogoutSessionRequired"></MCheckbox>
    </MCol>
    <MCol Md=6>
        <DefaultNumberTextField @bind-Value="Dto.UserSsoLifetime" Label="UserSsoLifetime" />
    </MCol>
    <MCol Md=6>
        <MCheckbox @bind-Value="Dto.EnableLocalLogin" Label="@T("EnableLocalLogin")" />
    </MCol>
    @*        <MCol Md=12>
    <DefaultTextField TValue="string" Label="IdentityProviderRestriction" />
    </MCol>*@
</MRow>

@code {

    [Parameter]
    public ClientAuthenticationDto Dto { get; set; } = new();

    [Parameter]
    public EventCallback<ClientAuthenticationDto> DtoChanged { get; set; }

    readonly string redirectUriSuffix = "/signin-oidc";
    readonly string logoutRedirectUriSuffix = "/signout-callback-oidc";

    private void AddCallBackRedirectUri()
    {
        if (Dto.RedirectUris.IndexOf(Dto.RedirectUri) < 0)
        {
            Dto.RedirectUris.Add($"{Dto.RedirectUri}{redirectUriSuffix}");
            Dto.RedirectUri = string.Empty;
        }
    }

    private void AddLogoutRedirectUri()
    {
        if (Dto.PostLogoutRedirectUris.IndexOf(Dto.PostLogoutRedirectUri) < 0)
        {
            Dto.PostLogoutRedirectUris.Add($"{Dto.PostLogoutRedirectUri}{logoutRedirectUriSuffix}");
            Dto.PostLogoutRedirectUri = string.Empty;
        }
    }

    private void RemoveCallBackRedirectUri(string val)
    {
        Dto.RedirectUris.Remove(val);
    }

    private void RemoveLogoutRedirectUri(string val)
    {
        Dto.PostLogoutRedirectUris.Remove(val);
    }
}
